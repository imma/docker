#!/usr/bin/env bash

function bootstrap {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"
  source "$shome/script/profile"

  local loader='env DEBIAN_FRONTEND=noninteractive'

  case "$(uname -s)" in
    Darwin)
      true
      ;;
    Linux)
      ${NOSUDO} sudo $loader apt-get install -y apt-transport-https ca-certificates curl software-properties-common
      curl -fsSL https://download.docker.com/linux/ubuntu/gpg | ${NOSUDO} sudo apt-key add -
      ${NOSUDO} sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
      ${NOSUDO} sudo apt-get update
      ${NOSUDO} sudo $loader apt-get install -y docker-ce="$DOCKER_UBUNTU_VERSION"
      ${NOSUDO} sudo aptitude hold docker-ce
      ${NOSUDO} sudo usermod -a -G docker ubuntu || true
      ${NOSUDO} sudo usermod -a -G staff ubuntu || true
      ;;
  esac
}

bootstrap
