#!/usr/bin/env bash

function bootstrap {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"
  source "$shome/script/profile"

  set -x
  case "${DISTRIB_ID}" in
    Darwin)
      brew update
      brew cask install caskroom/versions/docker-edge
      ;;
    Amazon)
      ${NOSUDO} sudo yum install -y docker
      ${NOSUDO} sudo usermod -a -G docker ec2-user || true
      ${NOSUDO} sudo usermod -a -G docker ubuntu || true
      ;;
    Ubuntu)
      local loader='env DEBIAN_FRONTEND=noninteractive'
      ${NOSUDO} sudo $loader apt-get install -y apt-transport-https ca-certificates curl software-properties-common
      curl -fsSL https://download.docker.com/linux/ubuntu/gpg | ${NOSUDO} sudo apt-key add -
      ${NOSUDO} sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
      ${NOSUDO} sudo apt-get update
      ${NOSUDO} sudo apt-mark unhold docker-ce 2>/dev/null 1>&2 || true
      ${NOSUDO} sudo $loader apt-get install -y docker-ce="${DOCKER_UBUNTU_VERSION}-*"
      ${NOSUDO} sudo aptitude hold docker-ce
      ${NOSUDO} sudo usermod -a -G docker ubuntu || true
      ${NOSUDO} sudo usermod -a -G staff ubuntu || true
      ;;
  esac
}

bootstrap
